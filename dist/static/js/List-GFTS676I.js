import{h as k}from"./moment-DFa0WlA5.js";import{_ as v,m as s,P as D,E as M,c as N,e as _,b as o,h as a,w as P,g as x,r as d,j as B,o as b,f as m,t as y}from"./index-DfmCOzbx.js";import{f as T,c as E}from"./workflow-B85YQqXY.js";const K="TEST_CALLER",S={setup(){const n=s([]),e=s(1),c=s(10),l=s(""),g=s(0),i=s(!1),u=s(!1),f=s({blur:"",operator:"",tenant:"",flowKey:""}),r={0:"默认",1:"草稿",2:"编辑中",3:"已下线",4:"已发布"};return{tableData:n,currentPage:e,pageSize:c,blur:l,moment:k,loading:i,getStatus:w=>r[w],dialogVisible:u,total:g,formInfo:f}},mounted(){this.findByPage()},methods:{findByPage(){this.loading=!0,T({current:this.currentPage,size:this.pageSize,blur:this.blur}).then(({data:n})=>{const{records:e,total:c}=n;this.tableData=e,this.loading=!1,this.total=c}).catch(n=>{this.loading=!1})},$_goDetail(n){let e=n.flowModuleId;D().handleTags("push",{name:"flow",path:"/workflow/flow",query:{flowModuleId:e},meta:{title:`流程图-${n.flowName}`,dynamicLevel:3}}),this.$router.push({name:"flow",query:{flowModuleId:e}})},showCreateFlow(){this.dialogVisible=!0},createFlowClick(){E({caller:K,flowName:this.formInfo.flowName,flowKey:this.formInfo.flowKey,operator:this.formInfo.operator,tenant:"TEST_TENANT"}).then(({data:n,errCode:e})=>{if(e===1e3){const{flowModuleId:c}=n;this.$_goDetail(c)}else throw new Error(n)}).catch(n=>{M({showClose:!0,message:"新建流程失败",type:"error"})})}}},L={class:"flow-container"},U={class:"flow-buttons"},F={class:"flow-list"},Y={class:"dialog-footer"};function z(n,e,c,l,g,i){const u=d("el-input"),f=d("el-button"),r=d("el-table-column"),h=d("el-table"),w=d("el-pagination"),p=d("el-form-item"),C=d("el-form"),V=d("el-dialog"),I=B("loading");return b(),N("div",L,[_("div",U,[o(u,{modelValue:l.blur,"onUpdate:modelValue":e[0]||(e[0]=t=>l.blur=t),class:"flow-search",placeholder:"模糊搜索",onChange:i.findByPage},null,8,["modelValue","onChange"]),o(f,{type:"primary",class:"search-flow",onClick:i.findByPage},{default:a(()=>[m("查询")]),_:1},8,["onClick"]),o(f,{type:"primary",class:"create-flow",onClick:i.showCreateFlow},{default:a(()=>[m("新建流程")]),_:1},8,["onClick"])]),_("div",F,[P((b(),x(h,{data:l.tableData,style:{width:"100%"}},{default:a(()=>[o(r,{type:"index",width:"50"}),o(r,{prop:"flowModuleId",label:"flowModuleId","show-overflow-tooltip":""}),o(r,{prop:"flowName",label:"流程名称"}),o(r,{prop:"flowKey",label:"flowKey"}),o(r,{label:"流程状态"},{default:a(t=>[m(y(l.getStatus(t.row.status)),1)]),_:1}),o(r,{label:"修改时间","min-width":"150"},{default:a(t=>[m(y(l.moment(t.row.modifyTime).format("YYYY/MM/DD HH:mm:ss")),1)]),_:1}),o(r,{prop:"operator",label:"修改人",width:"120"}),o(r,{label:"操作",width:"200"},{default:a(t=>[o(f,{type:"primary",text:"",onClick:A=>i.$_goDetail(t.row)},{default:a(()=>[m("查看流程")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[I,l.loading]]),o(w,{layout:"prev, pager, next",total:l.total,"current-page":l.currentPage,"onUpdate:currentPage":e[1]||(e[1]=t=>l.currentPage=t),onCurrentChange:i.findByPage},null,8,["total","current-page","onCurrentChange"])]),o(V,{modelValue:l.dialogVisible,"onUpdate:modelValue":e[6]||(e[6]=t=>l.dialogVisible=t),title:"新建流程",width:"30%"},{footer:a(()=>[_("span",Y,[o(f,{onClick:e[5]||(e[5]=t=>l.dialogVisible=!1)},{default:a(()=>[m("取消")]),_:1}),o(f,{type:"primary",onClick:i.createFlowClick},{default:a(()=>[m("新建")]),_:1},8,["onClick"])])]),default:a(()=>[o(C,{"label-position":n.right,"label-width":"100px",model:l.formInfo,style:{"max-width":"460px"}},{default:a(()=>[o(p,{label:"流程名称",prop:"flowName"},{default:a(()=>[o(u,{modelValue:l.formInfo.flowName,"onUpdate:modelValue":e[2]||(e[2]=t=>l.formInfo.flowName=t)},null,8,["modelValue"])]),_:1}),o(p,{label:"flowKey",prop:"flowKey"},{default:a(()=>[o(u,{modelValue:l.formInfo.flowKey,"onUpdate:modelValue":e[3]||(e[3]=t=>l.formInfo.flowKey=t)},null,8,["modelValue"])]),_:1}),o(p,{label:"创建人",prop:"operator"},{default:a(()=>[o(u,{modelValue:l.formInfo.operator,"onUpdate:modelValue":e[4]||(e[4]=t=>l.formInfo.operator=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["label-position","model"])]),_:1},8,["modelValue"])])}const j=v(S,[["render",z],["__scopeId","data-v-bd7d6e11"]]);export{j as default};
